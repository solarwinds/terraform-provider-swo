# query GetProbes {
#   dem {
#     probes {
#       id
#       ipv4
#       ipv6
#       region
#       city
#       country
#       coordinates {
#         latitude
#         longitude
#       }
#       active
#       name
#       platform
#     }
#   }
# }

query GetAlert {
  alertQueries {
    alertDefinitions(filter: {id: "0bc4710d-e3b0-4590-9c9b-e5e46d81d912"}) {
      alertDefinitions {
        id
        organizationId
        name
        description
        severity
        enabled
        muteInfo {
          muted
          until
        }
        triggered
        conditionType
        conditionUpdatedAt
        flatCondition {
          id
          links {
            name
            values
          }
          value {
            type
            operator
            entityFilter {
              type
              ids
            }
            dataType
            fieldName
            value
            metricFilter {
              id
              links {
                name
                values
              }
              value {
                operation
                propertyValue
                propertyValues
                propertyName
              }
            }
            source
            query
          }
        }
        actions {
          type
          configurationIds
        }
        triggerResetActions
      }
    }
  }
}

mutation CreateAlertDefinition {
  alertMutations {
    createAlertDefinition(
      definition: {
        name: "Metric alert", severity: INFO, enabled: true,
        condition: [
          { id: 0, type: "logicalOperator", operator: "OR", operandIds: [1, 6] },
          { id: 1, type: "binaryOperator", operator: "<", operandIds: [2, 5] },
          { id: 2, type: "aggregationOperator", operator: "AVG", operandIds: [3, 4] },
          { id: 3, type: "metricField", entityFilter: { type: "Website" }, fieldName: "healthscore" },
          { id: 4, type: "constantValue", dataType: "string", value: "10m" },
          { id: 5, type: "constantValue", dataType: "number", value: "70" },
          { id: 6, type: "binaryOperator", operator: ">", operandIds: [7, 10] },
          { id: 7, type: "aggregationOperator", operator: "AVG", operandIds: [8, 9] },
          { id: 8, type: "metricField", entityFilter:{
            type: "Website",
            ids: ["e-1415678067767222272"]},
            fieldName: "synthetics.https.response.time",
            metricFilter: {
              operation: NOT,
              children: {
                propertyName: "tagName",
                propertyValue: "tagValue",
                operation: EQ
                }
              }
            },
          { id: 9, type: "constantValue", dataType: "string", value: "5m"},
          { id: 10, type: "constantValue", dataType: "number", value: "100" }
        ],
        actions: [{type: "slack", configurationIds: ["notification-id-1"]}],
        triggerResetActions: true
      }
    ) {
      id
      organizationId
      name
      description
      severity
      enabled
      conditionType
      conditionUpdatedAt
      flatCondition {
        id
        links {
          name
          values
        }
        value {
          type
          operator
          entityFilter {
            type              
          } 
          fieldName
          dataType
          value
          query
          source
        }
      }
      actions {
        type
        configurationIds
      }
      triggerResetActions
    }
  }
}

mutation UpdateAlertDefinition {
  alertMutations {
    updateAlertDefinition(id: "246f719b-d160-4222-97e2-e9ced2203a8a",
      definition: {
        name: "My modified alert", description: "Modified description", severity: INFO, enabled: true,
        condition: [
          { id: 0, type: "binaryOperator", operator: "<", operandIds: [1, 4] },
          { id: 1, type: "aggregationOperator", operator: "AVG", operandIds: [2, 3] },
          { id: 2, type: "metricField", entityFilter: { type: "Website" }, fieldName: "healthscore" },
          { id: 3, type: "constantValue", dataType: "string", value: "10m" },
          { id: 4, type: "constantValue", dataType: "number", value: "70" }
        ],
        actions: [{type: "slack", configurationIds: ["notification-id-1"]}],
        triggerResetActions: false
      }
    ) {
      id
      organizationId
      name
      description
      severity
      enabled
      conditionType
      conditionUpdatedAt
      actions {
        type
        configurationIds
      }
      triggerResetActions
    }
  }
}

mutation DeleteAlertDefinition {
  alertMutations {
    deleteAlertDefinition(id: "246f719b-d160-4222-97e2-e9ced2203a8a")
  }
}